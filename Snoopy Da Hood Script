--[[
    Da Snoopy Hood Script - Rayfield Library
]]--

-- Load Rayfield Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
-- Services
local Players = game:GetService('Players')
local RunService = game:GetService('RunService')
local Workspace = game:GetService('Workspace')
local UserInputService = game:GetService('UserInputService')
local TweenService = game:GetService('TweenService')
local Lighting = game:GetService('Lighting')

-- Local Player
local LocalPlayer = Players.LocalPlayer

-- Variables
local CashAuraEnabled = false
local CashAuraRange = 25
local CashDropEnabled = false
local ESPEnabled = false
local ShowNames = true
local MoneyESPEnabled = false
local ESPColor = Color3.fromRGB(255, 0, 0)
local ESPTextColor = Color3.fromRGB(255, 255, 255)
local ESPTextSize = 14
local UseHealthColor = true
local ESPObjects = {}
local MoneyESPObjects = {}

-- CFrame Speed Variables
local CFrameSpeedEnabled = false
local CFrameSpeedValue = 1.5

-- CFrame Fly Variables
local CFrameFlyEnabled = false
local CFrameFlySpeed = 50

-- Aimbot Variables
local AimbotEnabled = false
local AimbotFOV = 100
local AimbotTarget = "Head"
local FOVCircleEnabled = true
local FOVCircleTransparency = 0.5
local FOVCircleColor = Color3.fromRGB(255, 255, 255)
local TracersEnabled = false
local TracerColor = Color3.fromRGB(255, 0, 0)
local AimbotKeybind = "MouseButton2"
local CurrentTarget = nil
local AimbotSmoothing = 0.3
local AimbotCameraTween = 0
local AimbotPrediction = 0
local AimbotHitChance = 100
local AimbotLOSCheck = false
local AimbotLockedColor = Color3.fromRGB(255, 80, 80)
local OriginalMouseDelta = UserInputService.MouseDeltaSensitivity
local AimbotKOCheck = false
local AimbotCrewCheck = false
local AimbotForceFieldCheck = false
local AimbotFOVFilled = false
local AimbotDownedGrabbedCheck = false
local AimbotGunOnly = false
local AimbotDynamicPrediction = false

-- Anti-slow WalkSpeed
local WalkSpeedEnabled = false
local WalkSpeedValue = 16

-- Hitbox expander
local HitboxEnabled = false
local HitboxSize = 5

-- Noclip / fog / ambient
local NoclipEnabled = false
local NoFogEnabled = false
local AmbientColor = nil

-- Create FOV Circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 64
FOVCircle.Radius = AimbotFOV
FOVCircle.Filled = AimbotFOVFilled
FOVCircle.Visible = false
FOVCircle.Color = FOVCircleColor
FOVCircle.Transparency = FOVCircleTransparency

local FOVCircleOutline = Drawing.new("Circle")
FOVCircleOutline.Thickness = 3
FOVCircleOutline.NumSides = 64
FOVCircleOutline.Radius = AimbotFOV + 1
FOVCircleOutline.Filled = false
FOVCircleOutline.Visible = false
FOVCircleOutline.Color = Color3.fromRGB(0, 0, 0)
FOVCircleOutline.Transparency = FOVCircleTransparency

-- Tracer storage
local TracerLines = {}

-- Create Rayfield Window
local Window = Rayfield:CreateWindow({
    Name = "Da Snoopy Hood",
    LoadingTitle = "Da Snoopy Hood",
    LoadingSubtitle = "by Snoopy",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "DaSnoopyHood",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Untitled",
        Subtitle = "Key System",
        Note = "No method of obtaining the key is provided",
        FileName = "Key",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"Hello"}
    }
})

-- =============================================
-- UTILITY FUNCTIONS
-- =============================================
local function GetCharacter()
    return LocalPlayer and LocalPlayer.Character
end

local function GetHRP()
    local char = GetCharacter()
    return char and char:FindFirstChild('HumanoidRootPart')
end

local function GetDistance(pos1, pos2)
    return (pos1 - pos2).Magnitude
end

local function IsTyping()
    return UserInputService:GetFocusedTextBox() ~= nil
end

-- WalkSpeed helper
local function ApplyWalkSpeed()
    local character = GetCharacter()
    local humanoid = character and character:FindFirstChildOfClass('Humanoid')
    if not humanoid then return end
    humanoid.WalkSpeed = WalkSpeedEnabled and WalkSpeedValue or 16
end

local function HookWalkSpeed(character)
    local humanoid = character and character:FindFirstChildOfClass('Humanoid')
    if humanoid then
        humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
            if WalkSpeedEnabled then
                humanoid.WalkSpeed = WalkSpeedValue
            end
        end)
        ApplyWalkSpeed()
    end
end

-- Noclip helper
local function SetNoclip(enabled)
    NoclipEnabled = enabled
end

-- Hitbox helper
local function UpdateHitboxes()
    if not HitboxEnabled then return end
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            local hrp = character and character:FindFirstChild('HumanoidRootPart')
            if hrp then
                hrp.Size = Vector3.new(HitboxSize, HitboxSize, HitboxSize)
                hrp.CanCollide = false
                hrp.Transparency = math.clamp(hrp.Transparency, 0, 0.5)
            end
        end
    end
end

local function ResetHitboxes()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            local hrp = character and character:FindFirstChild('HumanoidRootPart')
            if hrp then
                hrp.Size = Vector3.new(2, 2, 1)
                hrp.CanCollide = true
            end
        end
    end
end

local OriginalFogStart = nil
local OriginalFogEnd = nil
local OriginalAmbient = nil

local NoclipConnection
local HitboxConnection

local function StartNoclip()
    if NoclipConnection then return end
    NoclipConnection = RunService.Stepped:Connect(function()
        if not NoclipEnabled then return end
        local character = GetCharacter()
        if character then
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA('BasePart') then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function StopNoclip()
    if NoclipConnection then
        NoclipConnection:Disconnect()
        NoclipConnection = nil
    end
end

local function StartHitboxLoop()
    if HitboxConnection then return end
    HitboxConnection = RunService.Heartbeat:Connect(function()
        if HitboxEnabled then
            UpdateHitboxes()
        end
    end)
end

local function StopHitboxLoop()
    if HitboxConnection then
        HitboxConnection:Disconnect()
        HitboxConnection = nil
    end
    ResetHitboxes()
end

local function ApplyFogSettings()
    if NoFogEnabled then
        OriginalFogStart = OriginalFogStart or Lighting.FogStart
        OriginalFogEnd = OriginalFogEnd or Lighting.FogEnd
        Lighting.FogStart = 0
        Lighting.FogEnd = 100000
    else
        if OriginalFogStart then Lighting.FogStart = OriginalFogStart end
        if OriginalFogEnd then Lighting.FogEnd = OriginalFogEnd end
    end
end

local function ApplyAmbient()
    if not OriginalAmbient then
        OriginalAmbient = { Ambient = Lighting.Ambient, Outdoor = Lighting.OutdoorAmbient }
    end
    if AmbientColor then
        Lighting.Ambient = AmbientColor
        Lighting.OutdoorAmbient = AmbientColor
    else
        if OriginalAmbient then
            Lighting.Ambient = OriginalAmbient.Ambient
            Lighting.OutdoorAmbient = OriginalAmbient.Outdoor
        end
    end
end

--[[
    Da Snoopy Hood Script - Rayfield Library
    Part 2: Feature Systems (Cash, ESP, Movement)
]]--

-- =============================================
-- CASH AURA SYSTEM
-- =============================================
local CashAuraConnection

local function CollectCash()
    local hrp = GetHRP()
    if not hrp then return end
    
    local myPosition = hrp.Position
    local droppedItems = Workspace:FindFirstChild('Ignored') and Workspace.Ignored:FindFirstChild('Drop')
    if not droppedItems then return end
    
    for _, item in pairs(droppedItems:GetChildren()) do
        if not CashAuraEnabled then break end
        
        if item.Name == 'MoneyDrop' and item:IsA('BasePart') then
            local cashPosition = item.Position
            local distance = (myPosition - cashPosition).Magnitude
            
            if distance <= CashAuraRange then
                local clickDetector = item:FindFirstChildOfClass('ClickDetector')
                if clickDetector then
                    fireclickdetector(clickDetector)
                end
            end
        end
    end
end

local function StartCashAura()
    if CashAuraConnection then return end
    
    CashAuraConnection = task.spawn(function()
        while CashAuraEnabled do
            pcall(CollectCash)
            task.wait(0.1)
        end
    end)
end

local function StopCashAura()
    if CashAuraConnection then
        task.cancel(CashAuraConnection)
        CashAuraConnection = nil
    end
end

-- =============================================
-- CASH DROP SYSTEM
-- =============================================
local CashDropConnection

local function DropCash(amount)
    local ReplicatedStorage = game:GetService('ReplicatedStorage')
    local mainEvent = ReplicatedStorage:FindFirstChild('MainEvent')
    
    if mainEvent then
        pcall(function()
            mainEvent:FireServer('DropMoney', tostring(amount))
        end)
    end
end

local function StartCashDrop()
    if CashDropConnection then return end
    
    CashDropConnection = task.spawn(function()
        while CashDropEnabled do
            DropCash(15000)
            task.wait(1)
        end
    end)
end

local function StopCashDrop()
    if CashDropConnection then
        task.cancel(CashDropConnection)
        CashDropConnection = nil
    end
end

-- =============================================
-- ESP SYSTEM
-- =============================================
local function CreateESP(player)
    if player == LocalPlayer then return end
    if ESPObjects[player] then return end
    
    ESPObjects[player] = {}
    
    local billboard = Instance.new('BillboardGui')
    billboard.Name = 'NameESP'
    billboard.AlwaysOnTop = true
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.ResetOnSpawn = false
    
    local nameLabel = Instance.new('TextLabel')
    nameLabel.Parent = billboard
    nameLabel.BackgroundTransparency = 1
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = ESPTextSize
    nameLabel.TextColor3 = ESPTextColor
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    
    local highlight = Instance.new('Highlight')
    highlight.FillTransparency = 0.75
    highlight.FillColor = ESPColor
    highlight.OutlineTransparency = 0
    highlight.OutlineColor = ESPColor
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    
    ESPObjects[player] = {
        Billboard = billboard,
        NameLabel = nameLabel,
        Highlight = highlight
    }
    
    local function UpdateESP()
        if not ESPEnabled then
            billboard.Enabled = false
            highlight.Enabled = false
            return
        end
        
        local character = player.Character
        local head = character and character:FindFirstChild('Head')
        local humanoid = character and character:FindFirstChildOfClass('Humanoid')
        
        if character and head and humanoid then
            billboard.Adornee = head
            billboard.Parent = head
            billboard.Enabled = ShowNames
            
            nameLabel.TextSize = ESPTextSize
            nameLabel.TextColor3 = ESPTextColor
            
            highlight.Parent = character
            highlight.Enabled = true
            
            local health = math.floor(humanoid.Health)
            local maxHealth = math.floor(humanoid.MaxHealth)
            nameLabel.Text = ShowNames and string.format('%s [%d/%d]', player.Name, health, maxHealth) or ''
            
            if UseHealthColor then
                local healthPercent = humanoid.Health / humanoid.MaxHealth
                local color
                if healthPercent > 0.5 then
                    color = Color3.fromRGB(0, 255, 0)
                elseif healthPercent > 0.25 then
                    color = Color3.fromRGB(255, 255, 0)
                else
                    color = Color3.fromRGB(255, 0, 0)
                end
                highlight.OutlineColor = color
                highlight.FillColor = color
            else
                highlight.OutlineColor = ESPColor
                highlight.FillColor = ESPColor
            end
        else
            billboard.Enabled = false
            highlight.Enabled = false
        end
    end
    
    player.CharacterAdded:Connect(function()
        task.wait(0.5)
        UpdateESP()
    end)
    
    ESPObjects[player].Update = UpdateESP
    UpdateESP()
end

local function RemoveESP(player)
    if ESPObjects[player] then
        if ESPObjects[player].Billboard then
            ESPObjects[player].Billboard:Destroy()
        end
        if ESPObjects[player].Highlight then
            ESPObjects[player].Highlight:Destroy()
        end
        ESPObjects[player] = nil
    end
end

local function RefreshAllESP()
    for player, objects in pairs(ESPObjects) do
        if objects.Update then
            pcall(objects.Update)
        end
    end
end

local ESPUpdateConnection
local function StartESPLoop()
    if ESPUpdateConnection then return end
    ESPUpdateConnection = RunService.Heartbeat:Connect(function()
        if ESPEnabled then
            RefreshAllESP()
        end
    end)
end

local function InitializeESP()
    for _, player in pairs(Players:GetPlayers()) do
        CreateESP(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    CreateESP(player)
end)

Players.PlayerRemoving:Connect(function(player)
    RemoveESP(player)
end)

LocalPlayer.CharacterAdded:Connect(function(char)
    HookWalkSpeed(char)
end)

if LocalPlayer.Character then
    HookWalkSpeed(LocalPlayer.Character)
end

-- =============================================
-- MONEY ESP SYSTEM
-- =============================================
local MoneyESPConnection

local function ClearMoneyESP()
    for part, highlight in pairs(MoneyESPObjects) do
        if highlight then
            highlight:Destroy()
        end
    end
    MoneyESPObjects = {}
end

local function UpdateMoneyESP()
    if not MoneyESPEnabled then
        ClearMoneyESP()
        return
    end
    
    local droppedItems = Workspace:FindFirstChild('Ignored') and Workspace.Ignored:FindFirstChild('Drop')
    if not droppedItems then return end
    
    for part, highlight in pairs(MoneyESPObjects) do
        if not part or not part.Parent then
            if highlight then highlight:Destroy() end
            MoneyESPObjects[part] = nil
        end
    end
    
    for _, item in pairs(droppedItems:GetChildren()) do
        if item.Name == 'MoneyDrop' and item:IsA('BasePart') then
            if not MoneyESPObjects[item] then
                local highlight = Instance.new('Highlight')
                highlight.FillColor = Color3.fromRGB(0, 255, 0)
                highlight.FillTransparency = 0.5
                highlight.OutlineColor = Color3.fromRGB(0, 255, 0)
                highlight.OutlineTransparency = 0
                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                highlight.Parent = item
                MoneyESPObjects[item] = highlight
            end
        end
    end
end

local function StartMoneyESP()
    if MoneyESPConnection then return end
    MoneyESPConnection = RunService.Heartbeat:Connect(function()
        if MoneyESPEnabled then
            pcall(UpdateMoneyESP)
        end
    end)
end

local function StopMoneyESP()
    if MoneyESPConnection then
        MoneyESPConnection:Disconnect()
        MoneyESPConnection = nil
    end
    ClearMoneyESP()
end

-- =============================================
-- CFRAME SPEED SYSTEM
-- =============================================
local CFrameSpeedConnection

local function GetMovementDirection()
    local hrp = GetHRP()
    local humanoid = GetCharacter() and GetCharacter():FindFirstChildOfClass('Humanoid')
    if not hrp or not humanoid then return Vector3.new(0, 0, 0) end
    
    local moveDirection = humanoid.MoveDirection
    if moveDirection.Magnitude > 0 then
        return moveDirection.Unit
    end
    return Vector3.new(0, 0, 0)
end

local function StartCFrameSpeed()
    if CFrameSpeedConnection then return end
    
    CFrameSpeedConnection = RunService.Heartbeat:Connect(function(deltaTime)
        if not CFrameSpeedEnabled then return end
        
        local hrp = GetHRP()
        local humanoid = GetCharacter() and GetCharacter():FindFirstChildOfClass('Humanoid')
        if not hrp or not humanoid then return end
        
        local moveDir = GetMovementDirection()
        if moveDir.Magnitude > 0 then
            local extraSpeed = (CFrameSpeedValue - 1) * humanoid.WalkSpeed * deltaTime
            local newPos = hrp.Position + (moveDir * extraSpeed)
            hrp.CFrame = CFrame.new(newPos) * CFrame.Angles(hrp.CFrame:ToEulerAnglesXYZ())
        end
    end)
end

local function StopCFrameSpeed()
    if CFrameSpeedConnection then
        CFrameSpeedConnection:Disconnect()
        CFrameSpeedConnection = nil
    end
end

-- =============================================
-- CFRAME FLY SYSTEM
-- =============================================
local CFrameFlyConnection
local IsFlying = false
local FlyUpHeld = false
local FlyDownHeld = false

local function StartCFrameFly()
    if CFrameFlyConnection then return end
    IsFlying = true
    
    CFrameFlyConnection = RunService.Heartbeat:Connect(function(deltaTime)
        if not CFrameFlyEnabled then return end
        
        local hrp = GetHRP()
        local humanoid = GetCharacter() and GetCharacter():FindFirstChildOfClass('Humanoid')
        if not hrp or not humanoid then return end
        
        local moveDirection = humanoid.MoveDirection
        local verticalDirection = 0
        
        if FlyUpHeld then
            verticalDirection = 1
        end
        if FlyDownHeld then
            verticalDirection = -1
        end
        
        local horizontalMove = Vector3.new(moveDirection.X, 0, moveDirection.Z)
        local verticalMove = Vector3.new(0, verticalDirection, 0)
        local totalDirection = horizontalMove + verticalMove
        
        if totalDirection.Magnitude > 0 then
            local moveAmount = totalDirection.Unit * CFrameFlySpeed * deltaTime
            local newPosition = hrp.Position + moveAmount
            local currentRotation = hrp.CFrame - hrp.CFrame.Position
            hrp.CFrame = CFrame.new(newPosition) * currentRotation
        end
        
        local antiGravity = Vector3.new(0, Workspace.Gravity * deltaTime, 0)
        hrp.Velocity = Vector3.new(hrp.Velocity.X * 0.9, 0, hrp.Velocity.Z * 0.9) + antiGravity * 0
        hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
    end)
end

local function StopCFrameFly()
    if CFrameFlyConnection then
        CFrameFlyConnection:Disconnect()
        CFrameFlyConnection = nil
    end
    IsFlying = false
    
    local hrp = GetHRP()
    if hrp then
        hrp.Velocity = Vector3.new(hrp.Velocity.X, -10, hrp.Velocity.Z)
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if IsTyping() then return end
    if not CFrameFlyEnabled then return end
    
    if input.KeyCode == Enum.KeyCode.Space then 
        FlyUpHeld = true 
    end
    if input.KeyCode == Enum.KeyCode.LeftControl then 
        FlyDownHeld = true 
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Space then 
        FlyUpHeld = false 
    end
    if input.KeyCode == Enum.KeyCode.LeftControl then 
        FlyDownHeld = false 
    end
end)

--[[
    Da Snoopy Hood Script - Rayfield Library
    Part 3: Aimbot System
]]--

-- =============================================
-- AIMBOT SYSTEM
-- =============================================
local Camera = Workspace.CurrentCamera

local function GetMousePosition()
    local rawPos = UserInputService:GetMouseLocation()
    return Vector2.new(rawPos.X, rawPos.Y)
end

local function WorldToScreen(position)
    local screenPos, onScreen = Camera:WorldToScreenPoint(position)
    return Vector2.new(screenPos.X, screenPos.Y), onScreen, screenPos.Z
end

local function GetDistanceFromMouse(position)
    local screenPos, onScreen = WorldToScreen(position)
    if not onScreen then return math.huge end
    local mousePos = GetMousePosition()
    return (screenPos - mousePos).Magnitude
end

local function IsPlayerValid(player)
    if player == LocalPlayer then return false end
    local character = player.Character
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    local targetPart = character:FindFirstChild(AimbotTarget)
    if not targetPart then return false end
    if AimbotKOCheck or AimbotDownedGrabbedCheck then
        local bodyEffects = character:FindFirstChild("BodyEffects")
        local ko = bodyEffects and (bodyEffects:FindFirstChild("K.O") or bodyEffects:FindFirstChild("KO"))
        if AimbotKOCheck and ko and ko.Value then return false end
        if AimbotDownedGrabbedCheck then
            local grabbed = character:FindFirstChild("GRABBING_CONSTRAINT")
            if grabbed then return false end
        end
    end
    if AimbotForceFieldCheck and character:FindFirstChildOfClass("ForceField") then
        return false
    end
    if AimbotCrewCheck then
        local dataFolder = player:FindFirstChild("DataFolder")
        local info = dataFolder and dataFolder:FindFirstChild("Information")
        local crew = info and info:FindFirstChild("Crew")
        local localData = LocalPlayer:FindFirstChild("DataFolder")
        local localInfo = localData and localData:FindFirstChild("Information")
        local localCrew = localInfo and localInfo:FindFirstChild("Crew")
        if crew and localCrew and crew.Value ~= "" and localCrew.Value ~= "" and crew.Value == localCrew.Value then
            return false
        end
    end
    return true
end

local function HasLineOfSight(player)
    if not AimbotLOSCheck then return true end
    local character = player.Character
    if not character then return false end
    local targetPart = character:FindFirstChild(AimbotTarget)
    if not targetPart then return false end

    local ignoreList = {}
    for _, desc in ipairs(character:GetDescendants()) do
        table.insert(ignoreList, desc)
    end

    local parts = Camera:GetPartsObscuringTarget({ targetPart.Position }, ignoreList)
    return #parts == 0
end

local function IsTargetInFOV(player)
    local character = player.Character
    if not character then return false end
    local targetPart = character:FindFirstChild(AimbotTarget)
    if not targetPart then return false end
    return GetDistanceFromMouse(targetPart.Position) <= AimbotFOV
end

local function ShouldKeepTarget(player)
    return IsPlayerValid(player) and IsTargetInFOV(player) and HasLineOfSight(player)
end

local function MoveMouse(deltaX, deltaY)
    if mousemoverel then
        mousemoverel(deltaX, deltaY)
        return true
    end

    if mousemoveabs then
        local current = GetMousePosition()
        mousemoveabs(current.X + deltaX, current.Y + deltaY)
        return true
    end

    return false
end

local function GetClosestPlayer()
    local closestPlayer = nil
    local closestDistance = AimbotFOV
    
    for _, player in pairs(Players:GetPlayers()) do
        if IsPlayerValid(player) then
            local character = player.Character
            local targetPart = character:FindFirstChild(AimbotTarget)
            if targetPart then
                local distance = GetDistanceFromMouse(targetPart.Position)
                if distance < closestDistance then
                    closestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end
    
    return closestPlayer
end

local ActiveTween
local function ChancePassed()
    if AimbotHitChance >= 100 then return true end
    return math.random(1, 100) <= AimbotHitChance
end

local function AdjustedTargetPosition(targetPart)
    local predicted = targetPart.Position
    if AimbotPrediction > 0 then
        predicted = predicted + (targetPart.Velocity * AimbotPrediction)
    end
    return predicted
end

local function SetCameraSensitivity(disable)
    if disable then
        OriginalMouseDelta = UserInputService.MouseDeltaSensitivity
        UserInputService.MouseDeltaSensitivity = 0
    else
        UserInputService.MouseDeltaSensitivity = OriginalMouseDelta
    end
end

local function AimAt(player)
    if not player then return end
    local character = player.Character
    if not character then return end
    local targetPart = character:FindFirstChild(AimbotTarget)
    if not targetPart then return end
    
    local targetPos = AdjustedTargetPosition(targetPart)
    if AimbotDynamicPrediction then
        local distance = (Camera.CFrame.Position - targetPos).Magnitude
        local velMag = targetPart.Velocity.Magnitude
        local scale = math.clamp(velMag / math.max(distance, 1), 0, 2)
        targetPos = targetPart.Position + (targetPart.Velocity * AimbotPrediction * scale)
    end
    local screenPos, onScreen = WorldToScreen(targetPos)
    
    if onScreen and ChancePassed() then
        if ActiveTween then
            ActiveTween:Cancel()
            ActiveTween = nil
        end

        if AimbotCameraTween > 0 then
            ActiveTween = TweenService:Create(Camera, TweenInfo.new(AimbotCameraTween, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                CFrame = CFrame.new(Camera.CFrame.Position, targetPos)
            })
            ActiveTween:Play()
        else
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPos)
        end
        SetCameraSensitivity(true)
    end
end

local function ClearTracers()
    for _, line in pairs(TracerLines) do
        if line then
            pcall(function() line:Remove() end)
        end
    end
    TracerLines = {}
end

local function UpdateTracers()
    if not TracersEnabled then 
        ClearTracers()
        return 
    end
    
    local screenSize = Camera.ViewportSize
    local bottomCenter = Vector2.new(screenSize.X / 2, screenSize.Y)
    
    local validPlayers = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")
            local hrp = character and character:FindFirstChild("HumanoidRootPart")
            
            if character and humanoid and humanoid.Health > 0 and hrp then
                local screenPos, onScreen, depth = WorldToScreen(hrp.Position)
                if onScreen and depth > 0 then
                    table.insert(validPlayers, {pos = screenPos, player = player})
                end
            end
        end
    end
    
    while #TracerLines > #validPlayers do
        local line = table.remove(TracerLines)
        if line then pcall(function() line:Remove() end) end
    end
    
    for i, data in ipairs(validPlayers) do
        local line = TracerLines[i]
        if not line then
            line = Drawing.new("Line")
            TracerLines[i] = line
        end
        
        line.From = bottomCenter
        line.To = data.pos
        line.Color = TracerColor
        line.Thickness = 1
        line.Transparency = 1
        line.Visible = true
    end
end

local AimbotConnection
local AimbotHeld = false

local function StartAimbot()
    if AimbotConnection then return end
    
    AimbotConnection = RunService.RenderStepped:Connect(function()
        local ok, err = pcall(function()
            Camera = Workspace.CurrentCamera
            
            if FOVCircleEnabled and AimbotEnabled then
                local mousePos = GetMousePosition()
                FOVCircle.Position = mousePos
                FOVCircleOutline.Position = mousePos
                FOVCircle.Radius = AimbotFOV
                FOVCircleOutline.Radius = AimbotFOV + 1
                FOVCircleOutline.Transparency = FOVCircleTransparency
                FOVCircleOutline.Visible = true
                FOVCircleOutline.Color = Color3.fromRGB(0, 0, 0)
                FOVCircle.Color = FOVCircleColor
                FOVCircle.Transparency = FOVCircleTransparency
                FOVCircle.Filled = AimbotFOVFilled
                FOVCircle.Visible = true
            else
                FOVCircle.Visible = false
                FOVCircleOutline.Visible = false
            end
            
            UpdateTracers()
            
            if AimbotEnabled and AimbotHeld then
                if AimbotGunOnly then
                    local character = GetCharacter()
                    local holdingTool = character and character:FindFirstChildOfClass("Tool")
                    if not holdingTool then
                        return
                    end
                end
                if not (CurrentTarget and ShouldKeepTarget(CurrentTarget)) then
                    CurrentTarget = GetClosestPlayer()
                end

                if CurrentTarget then
                    FOVCircle.Color = AimbotLockedColor
                    AimAt(CurrentTarget)
                else
                    FOVCircle.Color = FOVCircleColor
                end
            else
                CurrentTarget = nil
                FOVCircle.Color = FOVCircleColor
                SetCameraSensitivity(false)
            end
        end)

        if not ok then
            warn('[Aimbot Loop Error]', err)
        end
    end)
end

local function StopAimbot()
    if AimbotConnection then
        AimbotConnection:Disconnect()
        AimbotConnection = nil
    end
    if ActiveTween then
        ActiveTween:Cancel()
        ActiveTween = nil
    end
    SetCameraSensitivity(false)
    FOVCircle.Visible = false
    FOVCircleOutline.Visible = false
    ClearTracers()
end

local function UpdateAimbotLoop()
    if AimbotEnabled or TracersEnabled then
        StartAimbot()
    else
        StopAimbot()
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if IsTyping() then return end
    
    local mouseMatch = (AimbotKeybind == "MouseButton2" and input.UserInputType == Enum.UserInputType.MouseButton2) or (AimbotKeybind == "MouseButton1" and input.UserInputType == Enum.UserInputType.MouseButton1)
    local keyMatch = (input.KeyCode ~= Enum.KeyCode.Unknown and AimbotKeybind == input.KeyCode.Name)

    if mouseMatch or keyMatch then
        AimbotHeld = true
        CurrentTarget = GetClosestPlayer()
    end
end)

UserInputService.InputEnded:Connect(function(input)
    local mouseMatch = (AimbotKeybind == "MouseButton2" and input.UserInputType == Enum.UserInputType.MouseButton2) or (AimbotKeybind == "MouseButton1" and input.UserInputType == Enum.UserInputType.MouseButton1)
    local keyMatch = (input.KeyCode ~= Enum.KeyCode.Unknown and AimbotKeybind == input.KeyCode.Name)

    if mouseMatch or keyMatch then
        AimbotHeld = false
        CurrentTarget = nil
        if ActiveTween then
            ActiveTween:Cancel()
            ActiveTween = nil
        end
        SetCameraSensitivity(false)
    end
end)

--[[
    Da Snoopy Hood Script - Rayfield Library
]]--

-- =============================================
-- RAYFIELD UI - MAIN TAB
-- =============================================
local MainTab = Window:CreateTab("Main", 4483362458)

-- Cash Section
local CashSection = MainTab:CreateSection("Cash")
CashSection:CreateToggle("Cash Aura", {
    CurrentValue = false,
    Flag = "CashAura",
    Callback = function(Value)
        CashAuraEnabled = Value
        if Value then
            StartCashAura()
            Rayfield:Notify({
                Title = "Cash Aura",
                Content = "Cash Aura Enabled!",
                Duration = 2,
                Image = 4483362458
            })
        else
            StopCashAura()
            Rayfield:Notify({
                Title = "Cash Aura",
                Content = "Cash Aura Disabled!",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

CashSection:CreateSlider("Aura Range", {
    Range = {10, 100},
    Increment = 1,
    Suffix = "Studs",
    CurrentValue = 25,
    Flag = "CashRange",
    Callback = function(Value)
        CashAuraRange = Value
    end
})

CashSection:CreateToggle("Auto Drop $15,000", {
    CurrentValue = false,
    Flag = "CashDrop",
    Callback = function(Value)
        CashDropEnabled = Value
        if Value then
            StartCashDrop()
            Rayfield:Notify({
                Title = "Cash Drop",
                Content = "Spamming cash drop!",
                Duration = 2,
                Image = 4483362458
            })
        else
            StopCashDrop()
            Rayfield:Notify({
                Title = "Cash Drop",
                Content = "Stopped cash drop",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

-- Movement Section
local MovementSection = MainTab:CreateSection("Movement")
MovementSection:CreateToggle("CFrame Speed", {
    CurrentValue = false,
    Flag = "CFrameSpeed",
    Callback = function(Value)
        CFrameSpeedEnabled = Value
        if Value then
            StartCFrameSpeed()
            Rayfield:Notify({
                Title = "CFrame Speed",
                Content = "CFrame Speed Enabled!",
                Duration = 2,
                Image = 4483362458
            })
        else
            StopCFrameSpeed()
            Rayfield:Notify({
                Title = "CFrame Speed",
                Content = "CFrame Speed Disabled!",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

MovementSection:CreateSlider("Speed Multiplier", {
    Range = {1.1, 5},
    Increment = 0.1,
    Suffix = "x",
    CurrentValue = 1.5,
    Flag = "SpeedMultiplier",
    Callback = function(Value)
        CFrameSpeedValue = Value
    end
})

MovementSection:CreateToggle("CFrame Fly", {
    CurrentValue = false,
    Flag = "CFrameFly",
    Callback = function(Value)
        CFrameFlyEnabled = Value
        if Value then
            StartCFrameFly()
            Rayfield:Notify({
                Title = "CFrame Fly",
                Content = "Flying! WASD to move, Space/Ctrl for up/down",
                Duration = 3,
                Image = 4483362458
            })
        else
            StopCFrameFly()
            Rayfield:Notify({
                Title = "CFrame Fly",
                Content = "Fly Disabled",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

MovementSection:CreateSlider("Fly Speed", {
    Range = {10, 200},
    Increment = 1,
    Suffix = "Studs/s",
    CurrentValue = 50,
    Flag = "FlySpeed",
    Callback = function(Value)
        CFrameFlySpeed = Value
    end
})

MovementSection:CreateToggle("Anti-Slow WalkSpeed", {
    CurrentValue = false,
    Flag = "WalkSpeedToggle",
    Callback = function(Value)
        WalkSpeedEnabled = Value
        ApplyWalkSpeed()
        if Value then
            Rayfield:Notify({
                Title = "WalkSpeed",
                Content = "Anti-Slow Enabled!",
                Duration = 2,
                Image = 4483362458
            })
        else
            Rayfield:Notify({
                Title = "WalkSpeed",
                Content = "Anti-Slow Disabled!",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

MovementSection:CreateSlider("WalkSpeed", {
    Range = {16, 500},
    Increment = 1,
    Suffix = "Studs/s",
    CurrentValue = 16,
    Flag = "WalkSpeedValue",
    Callback = function(Value)
        WalkSpeedValue = Value
        if WalkSpeedEnabled then
            ApplyWalkSpeed()
        end
    end
})

-- =============================================
-- RAYFIELD UI - AIMBOT TAB
-- =============================================
local AimbotTab = Window:CreateTab("Aimbot", 4483362458)

-- Aimbot Settings
local AimbotSettings = AimbotTab:CreateSection("Aimbot Settings")
AimbotSettings:CreateToggle("Enable Aimbot", {
    CurrentValue = false,
    Flag = "AimbotEnabled",
    Callback = function(Value)
        AimbotEnabled = Value
        UpdateAimbotLoop()
        if Value then
            Rayfield:Notify({
                Title = "Aimbot",
                Content = "Aimbot Enabled! Right-click to aim",
                Duration = 2,
                Image = 4483362458
            })
        else
            Rayfield:Notify({
                Title = "Aimbot",
                Content = "Aimbot Disabled",
                Duration = 2,
                Image = 4483362458
            })
        end
    end
})

AimbotSettings:CreateDropdown("Target Part", {
    Values = {"Head", "HumanoidRootPart"},
    CurrentOption = "Head",
    Flag = "AimbotTargetPart",
    Callback = function(Value)
        AimbotTarget = Value
    end
})

AimbotSettings:CreateSlider("Smoothing", {
    Range = {0.05, 1},
    Increment = 0.01,
    CurrentValue = 0.3,
    Flag = "AimbotSmoothing",
    Callback = function(Value)
        AimbotSmoothing = Value
    end
})

AimbotSettings:CreateSlider("Camera Tween", {
    Range = {0, 1},
    Increment = 0.01,
    Suffix = "s",
    CurrentValue = 0,
    Flag = "AimbotCameraTween",
    Callback = function(Value)
        AimbotCameraTween = Value
    end
})

AimbotSettings:CreateSlider("Prediction", {
    Range = {0, 0.3},
    Increment = 0.001,
    CurrentValue = 0,
    Flag = "AimbotPrediction",
    Callback = function(Value)
        AimbotPrediction = Value
    end
})

AimbotSettings:CreateSlider("Hit Chance", {
    Range = {1, 100},
    Increment = 1,
    Suffix = "%",
    CurrentValue = 100,
    Flag = "AimbotHitChance",
    Callback = function(Value)
        AimbotHitChance = Value
    end
})

AimbotSettings:CreateDropdown("Aim Key", {
    Values = {"MouseButton2", "MouseButton1", "Q", "E", "LeftShift", "LeftAlt"},
    CurrentOption = "MouseButton2",
    Flag = "AimbotKeybind",
    Callback = function(Value)
        AimbotKeybind = Value
    end
})

-- Aimbot Checks
local AimbotChecks = AimbotTab:CreateSection("Aimbot Checks")
AimbotChecks:CreateToggle("Line of Sight Check", {
    CurrentValue = false,
    Flag = "AimbotLOSCheck",
    Callback = function(Value)
        AimbotLOSCheck = Value
    end
})

AimbotChecks:CreateToggle("Ignore KO'd Targets", {
    CurrentValue = false,
    Flag = "AimbotKOCheck",
    Callback = function(Value)
        AimbotKOCheck = Value
    end
})

AimbotChecks:CreateToggle("Ignore Same Crew", {
    CurrentValue = false,
    Flag = "AimbotCrewCheck",
    Callback = function(Value)
        AimbotCrewCheck = Value
    end
})

AimbotChecks:CreateToggle("Ignore ForceField", {
    CurrentValue = false,
    Flag = "AimbotForceFieldCheck",
    Callback = function(Value)
        AimbotForceFieldCheck = Value
    end
})

AimbotChecks:CreateToggle("Ignore Downed/Grabbed", {
    CurrentValue = false,
    Flag = "AimbotDownedGrabbedCheck",
    Callback = function(Value)
        AimbotDownedGrabbedCheck = Value
    end
})

AimbotChecks:CreateToggle("Gun Only", {
    CurrentValue = false,
    Flag = "AimbotGunOnly",
    Callback = function(Value)
        AimbotGunOnly = Value
    end
})

AimbotChecks:CreateToggle("Dynamic Prediction", {
    CurrentValue = false,
    Flag = "AimbotDynamicPrediction",
    Callback = function(Value)
        AimbotDynamicPrediction = Value
    end
})

-- FOV Settings
local FOVSettings = AimbotTab:CreateSection("FOV Settings")
FOVSettings:CreateToggle("Show FOV Circle", {
    CurrentValue = true,
    Flag = "FOVCircleEnabled",
    Callback = function(Value)
        FOVCircleEnabled = Value
        FOVCircle.Visible = Value and AimbotEnabled
    end
})

FOVSettings:CreateToggle("Filled FOV", {
    CurrentValue = false,
    Flag = "FOVFilled",
    Callback = function(Value)
        AimbotFOVFilled = Value
        FOVCircle.Filled = Value
    end
})

FOVSettings:CreateSlider("FOV Size", {
    Range = {20, 500},
    Increment = 1,
    CurrentValue = 100,
    Flag = "FOVSize",
    Callback = function(Value)
        AimbotFOV = Value
        FOVCircle.Radius = Value
    end
})

FOVSettings:CreateSlider("FOV Opacity", {
    Range = {0, 1},
    Increment = 0.01,
    CurrentValue = 0.5,
    Flag = "FOVTransparency",
    Callback = function(Value)
        FOVCircleTransparency = Value
        FOVCircle.Transparency = Value
    end
})

FOVSettings:CreateColorPicker("FOV Color", {
    Default = Color3.fromRGB(255, 255, 255),
    Flag = "FOVColor",
    Callback = function(Value)
        FOVCircleColor = Value
        FOVCircle.Color = Value
    end
})

FOVSettings:CreateColorPicker("Locked Color", {
    Default = Color3.fromRGB(255, 80, 80),
    Flag = "LockedColor",
    Callback = function(Value)
        AimbotLockedColor = Value
    end
})

-- Tracers
local TracerSettings = AimbotTab:CreateSection("Tracers")
TracerSettings:CreateToggle("Enable Tracers", {
    CurrentValue = false,
    Flag = "TracersEnabled",
    Callback = function(Value)
        TracersEnabled = Value
        UpdateAimbotLoop()
        if not Value then
            ClearTracers()
        end
    end
})

TracerSettings:CreateColorPicker("Tracer Color", {
    Default = Color3.fromRGB(255, 0, 0),
    Flag = "TracerColor",
    Callback = function(Value)
        TracerColor = Value
    end
})

-- =============================================
-- RAYFIELD UI - VISUALS TAB
-- =============================================
local VisualsTab = Window:CreateTab("Visuals", 4483362458)

-- ESP Settings
local ESPSettings = VisualsTab:CreateSection("ESP Settings")
ESPSettings:CreateToggle("Enable ESP", {
    CurrentValue = false,
    Flag = "ESPToggle",
    Callback = function(Value)
        ESPEnabled = Value
        if Value then
            InitializeESP()
            StartESPLoop()
        end
        RefreshAllESP()
    end
})

ESPSettings:CreateToggle("Show Names", {
    CurrentValue = true,
    Flag = "ShowNames",
    Callback = function(Value)
        ShowNames = Value
    end
})

ESPSettings:CreateToggle("Health-Based Color", {
    CurrentValue = true,
    Flag = "UseHealthColor",
    Callback = function(Value)
        UseHealthColor = Value
    end
})

ESPSettings:CreateColorPicker("ESP Color", {
    Default = Color3.fromRGB(255, 0, 0),
    Flag = "ESPColor",
    Callback = function(Value)
        ESPColor = Value
    end
})

ESPSettings:CreateColorPicker("Text Color", {
    Default = Color3.fromRGB(255, 255, 255),
    Flag = "TextColor",
    Callback = function(Value)
        ESPTextColor = Value
    end
})

ESPSettings:CreateSlider("Text Size", {
    Range = {8, 24},
    Increment = 1,
    CurrentValue = 14,
    Flag = "TextSize",
    Callback = function(Value)
        ESPTextSize = Value
    end
})

-- World Visuals
local WorldVisuals = VisualsTab:CreateSection("World Visuals")
WorldVisuals:CreateToggle("Money ESP", {
    CurrentValue = false,
    Flag = "MoneyESP",
    Callback = function(Value)
        MoneyESPEnabled = Value
        if Value then
            StartMoneyESP()
        else
            StopMoneyESP()
        end
    end
})

WorldVisuals:CreateToggle("Hitbox Expander", {
    CurrentValue = false,
    Flag = "HitboxExpander",
    Callback = function(Value)
        HitboxEnabled = Value
        if Value then
            StartHitboxLoop()
        else
            StopHitboxLoop()
        end
    end
})

WorldVisuals:CreateSlider("Hitbox Size", {
    Range = {2, 20},
    Increment = 1,
    CurrentValue = 5,
    Flag = "HitboxSize",
    Callback = function(Value)
        HitboxSize = Value
    end
})

WorldVisuals:CreateToggle("Noclip (local)", {
    CurrentValue = false,
    Flag = "NoclipToggle",
    Callback = function(Value)
        SetNoclip(Value)
        if Value then
            StartNoclip()
        else
            StopNoclip()
        end
    end
})

WorldVisuals:CreateToggle("No Fog", {
    CurrentValue = false,
    Flag = "NoFogToggle",
    Callback = function(Value)
        NoFogEnabled = Value
        ApplyFogSettings()
    end
})

WorldVisuals:CreateColorPicker("Ambient Color", {
    Default = Color3.fromRGB(127, 127, 127),
    Flag = "AmbientColor",
    Callback = function(Value)
        AmbientColor = Value
        ApplyAmbient()
    end
})

-- =============================================
-- RAYFIELD UI - SETTINGS TAB
-- =============================================
local SettingsTab = Window:CreateTab("Settings", 4483362458)

-- Menu Settings
local MenuSettings = SettingsTab:CreateSection("Menu Settings")
MenuSettings:CreateKeybind("Toggle Keybind", {
    CurrentKeybind = "End",
    HoldToInteract = false,
    Flag = "MenuKeybind",
    Callback = function(Keybind)
        Window.Keybind = Keybind
    end
})

MenuSettings:CreateToggle("Show Watermark", {
    CurrentValue = true,
    Flag = "WatermarkToggle",
    Callback = function(Value)
        Rayfield:SetWatermarkVisibility(Value)
    end
})

MenuSettings:CreateSlider("Menu Transparency", {
    Range = {0, 50},
    Increment = 1,
    Suffix = "%",
    CurrentValue = 0,
    Flag = "MenuTransparency",
    Callback = function(Value)
        Rayfield:SetTransparency(Value / 100)
    end
})

MenuSettings:CreateButton("Unload Script", function()
    -- Cleanup
    CashAuraEnabled = false
    CashDropEnabled = false
    MoneyESPEnabled = false
    CFrameSpeedEnabled = false
    CFrameFlyEnabled = false
    AimbotEnabled = false
    TracersEnabled = false
    WalkSpeedEnabled = false
    HitboxEnabled = false
    NoclipEnabled = false
    NoFogEnabled = false
    AmbientColor = nil
    
    StopCashAura()
    StopCashDrop()
    StopMoneyESP()
    StopCFrameSpeed()
    StopCFrameFly()
    StopAimbot()
    StopHitboxLoop()
    StopNoclip()
    ApplyFogSettings()
    ApplyAmbient()
    
    FOVCircle:Remove()
    ClearTracers()
    
    if ESPUpdateConnection then
        ESPUpdateConnection:Disconnect()
    end
    
    for player, _ in pairs(ESPObjects) do
        RemoveESP(player)
    end
    
    Rayfield:Destroy()
    
    Rayfield:Notify({
        Title = "Da Snoopy Hood",
        Content = "Script Unloaded!",
        Duration = 3,
        Image = 4483362458
    })
end)

-- Configuration
local ConfigSection = SettingsTab:CreateSection("Configuration")
ConfigSection:CreateButton("Save Configuration", function()
    Rayfield:Notify({
        Title = "Configuration",
        Content = "Configuration saved!",
        Duration = 2,
        Image = 4483362458
    })
end)

ConfigSection:CreateButton("Load Configuration", function()
    Rayfield:Notify({
        Title = "Configuration",
        Content = "Configuration loaded!",
        Duration = 2,
        Image = 4483362458
    })
end)

-- Initialize ESP
InitializeESP()

-- Notify user
Rayfield:Notify({
    Title = "Da Snoopy Hood",
    Content = "Script Loaded Successfully!",
    Duration = 5,
    Image = 4483362458
})

-- Load configuration
Rayfield:LoadConfiguration()
